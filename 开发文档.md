# 家庭监控仪表盘 - 跨平台桌面应用开发文档

## 1. 项目概述

### 1.1 项目目标
基于现有的 HTML 仪表盘界面，开发一个跨平台桌面应用程序，支持 Windows 和树莓派（Linux ARM）平台。

### 1.2 核心功能
- 服务器健康监控（CPU、内存、存储）
- 家庭设备控制（灯光、门锁、温控等）
- 网络活动监控
- 在线服务状态管理
- 深色/浅色主题切换
- 实时数据更新

---

## 2. 技术栈分析

### 2.1 候选技术方案对比

| 技术方案 | Windows 支持 | 树莓派支持 | 性能 | 资源占用 | 开发复杂度 | 复用现有代码 | 推荐指数 |
|---------|------------|-----------|------|---------|-----------|-------------|---------|
| **Tauri** | ✅ 优秀 | ✅ 优秀 | ⭐⭐⭐⭐⭐ | 低 | 中 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| Electron | ✅ 优秀 | ⚠️ 一般 | ⭐⭐⭐ | 高 | 低 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |
| Flutter Desktop | ✅ 优秀 | ✅ 优秀 | ⭐⭐⭐⭐⭐ | 中 | 高 | ⭐ | ⭐⭐⭐ |
| Python + PyQt | ✅ 良好 | ✅ 优秀 | ⭐⭐⭐⭐ | 低 | 中 | ⭐⭐ | ⭐⭐⭐ |
| Qt/C++ | ✅ 优秀 | ✅ 优秀 | ⭐⭐⭐⭐⭐ | 低 | 高 | ⭐ | ⭐⭐ |

### 2.2 推荐技术栈：Tauri

#### 选择理由
1. **完美复用现有代码**：可以直接使用现有的 HTML/CSS/JS 代码
2. **轻量级**：相比 Electron，内存占用减少 80%+，适合树莓派
3. **跨平台支持**：原生支持 Windows、Linux（包括 ARM 架构）
4. **安全性高**：基于 Rust，内存安全，无传统安全漏洞
5. **性能优秀**：使用系统原生 WebView，渲染性能好
6. **打包体积小**：最终应用体积通常 < 10MB

---

## 3. 技术架构设计

### 3.1 整体架构

```
┌─────────────────────────────────────────┐
│           前端层 (Frontend)             │
│  ┌─────────────────────────────────┐   │
│  │  HTML + Tailwind CSS + Vanilla  │   │
│  │  JavaScript (现有代码复用)       │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
                    ↕ Tauri IPC
┌─────────────────────────────────────────┐
│           后端层 (Backend)              │
│  ┌─────────────────────────────────┐   │
│  │  Rust Core (Tauri Runtime)     │   │
│  │  - 系统信息采集                 │   │
│  │  - 网络监控                     │   │
│  │  - 设备控制接口                 │   │
│  │  - 数据持久化                   │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
                    ↕
┌─────────────────────────────────────────┐
│           系统层 (System)                │
│  Windows / Linux (ARM64/x86_64)         │
└─────────────────────────────────────────┘
```

### 3.2 核心技术组件

#### 前端技术
- **HTML5**: 页面结构（复用现有代码）
- **Tailwind CSS**: 样式框架（通过 CDN 或本地构建）
- **Vanilla JavaScript**: 业务逻辑（复用现有代码）
- **Material Icons**: 图标库

#### 后端技术
- **Rust**: 核心后端语言
- **Tauri**: 应用框架
- **tokio**: 异步运行时
- **serde**: 序列化/反序列化
- **sysinfo**: 系统信息采集

---

## 4. 项目结构设计

```
monitor-dashboard/
├── src-tauri/                 # Rust 后端代码
│   ├── src/
│   │   ├── main.rs           # 应用入口
│   │   ├── commands/         # Tauri 命令
│   │   │   ├── mod.rs
│   │   │   ├── system.rs     # 系统信息采集
│   │   │   ├── network.rs    # 网络监控
│   │   │   └── devices.rs    # 设备控制
│   │   ├── services/         # 业务服务
│   │   │   ├── mod.rs
│   │   │   ├── monitor.rs    # 监控服务
│   │   │   └── storage.rs    # 数据存储
│   │   └── utils/            # 工具函数
│   ├── Cargo.toml            # Rust 依赖配置
│   ├── tauri.conf.json       # Tauri 配置
│   └── icons/                # 应用图标
│
├── src/                      # 前端代码
│   ├── index.html            # 主页面（现有代码）
│   ├── css/                  # 样式文件
│   ├── js/                   # JavaScript 代码
│   │   ├── app.js            # 应用逻辑
│   │   └── api.js            # API 调用封装
│   └── assets/               # 静态资源
│
├── package.json              # Node.js 配置（构建工具）
├── README.md                 # 项目说明
└── docs/                     # 文档目录
    ├── api.md               # API 文档
    └── deployment.md        # 部署文档
```

---

## 5. 核心功能实现方案

### 5.1 系统信息采集

**技术选型**: Rust + sysinfo crate

```rust
// src-tauri/src/commands/system.rs
use sysinfo::{System, SystemExt, CpuExt};

#[tauri::command]
pub async fn get_system_info() -> Result<SystemInfo, String> {
    let mut sys = System::new_all();
    sys.refresh_all();
    
    Ok(SystemInfo {
        cpu_usage: sys.global_cpu_info().cpu_usage(),
        memory_used: sys.used_memory(),
        memory_total: sys.total_memory(),
        disk_available: get_disk_available(),
    })
}
```

### 5.2 网络监控

**技术选型**: Rust + pnet crate

```rust
// src-tauri/src/commands/network.rs
#[tauri::command]
pub async fn get_network_stats() -> Result<NetworkStats, String> {
    let download_speed = measure_download_speed().await?;
    let upload_speed = measure_upload_speed().await?;
    
    Ok(NetworkStats {
        download: download_speed,
        upload: upload_speed,
    })
}
```

### 5.3 设备控制

**技术选型**: 
- MQTT 协议（推荐，适合物联网）
- HTTP API（简单场景）
- GPIO 控制（树莓派本地设备）

```rust
// src-tauri/src/commands/devices.rs
#[tauri::command]
pub async fn toggle_light(room: String, state: bool) -> Result<(), String> {
    mqtt_client.publish(&format!("home/{}/light", room), state).await?;
    Ok(())
}
```

### 5.4 实时数据更新

**技术选型**: Tauri Events + 前端轮询

```rust
// 后端：定期发送事件
pub fn start_monitoring() {
    tauri::async_runtime::spawn(async move {
        loop {
            let info = get_system_info().await.unwrap();
            AppHandle::emit_all("system-update", info);
            tokio::time::sleep(Duration::from_secs(5)).await;
        }
    });
}

// 前端：监听事件
import { listen } from '@tauri-apps/api/event';

listen('system-update', (event) => {
    updateDashboard(event.payload);
});
```

---

## 6. 开发环境配置

### 6.1 基础依赖

#### Windows 开发环境
```powershell
# 安装 Rust
winget install Rustlang.Rust.MSVC

# 安装 Node.js
winget install OpenJS.NodeJS

# 安装 Tauri CLI
cargo install tauri-cli

# 安装 WebView2（Windows 11 已内置）
# Windows 10 需要手动安装
```

#### 树莓派开发环境
```bash
# 安装 Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# 安装 Node.js
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 安装系统依赖
sudo apt-get install -y libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    file \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev
```

### 6.2 项目初始化

```bash
# 创建 Tauri 项目
cargo install tauri-cli
cargo tauri init

# 或使用 npm
npm create tauri-app

# 配置项目
# 将现有的 bash.html 复制到 src/index.html
```

---

## 7. 构建与部署

### 7.1 开发模式

```bash
# 启动开发服务器
npm run tauri dev

# 或使用 cargo
cargo tauri dev
```

### 7.2 生产构建

#### Windows 构建
```bash
# 构建 MSI 安装包
cargo tauri build

# 输出位置
# src-tauri/target/release/bundle/msi/
```

#### 树莓派构建
```bash
# 交叉编译（在 x86_64 机器上）
cargo tauri build --target aarch64-unknown-linux-gnu

# 或直接在树莓派上编译
cargo tauri build

# 输出位置
# src-tauri/target/release/bundle/deb/
```

### 7.3 自动更新

使用 Tauri 内置的更新器：

```rust
// src-tauri/src/main.rs
use tauri_plugin_updater::AppUpdater;

fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_updater::Builder::new().build())
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

---

## 8. 平台适配策略

### 8.1 Windows 特性
- 系统托盘图标
- 开机自启动
- Windows 通知集成
- 高 DPI 支持

### 8.2 树莓派特性
- GPIO 接口控制
- 低功耗模式
- 系统服务集成
- 硬件监控（温度、电压）

### 8.3 通用适配
```rust
#[cfg(target_os = "windows")]
fn platform_specific() {
    // Windows 特定逻辑
}

#[cfg(target_os = "linux")]
fn platform_specific() {
    // Linux 特定逻辑
}

#[cfg(target_arch = "aarch64")]
fn arch_specific() {
    // ARM 架构特定逻辑（树莓派）
}
```

---

## 9. 性能优化建议

### 9.1 前端优化
- 使用虚拟滚动处理长列表
- 图片懒加载
- CSS 动画使用 GPU 加速
- 减少 DOM 操作频率

### 9.2 后端优化
- 使用异步 I/O（tokio）
- 缓存系统信息（避免频繁读取）
- 使用连接池管理数据库连接
- 合理设置轮询间隔

### 9.3 资源优化
- 压缩静态资源
- 使用 WebP 格式图片
- 禁用不必要的 Tauri 功能
- 按需加载依赖

---

## 10. 安全考虑

### 10.1 数据安全
- 敏感数据加密存储
- 使用安全的通信协议（HTTPS/WSS）
- 定期更新依赖库

### 10.2 权限管理
- 最小权限原则
- 用户输入验证
- 防止命令注入

### 10.3 网络安全
- API 认证
- 速率限制
- 防止 CSRF 攻击

---

## 11. 测试策略

### 11.1 单元测试
```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_system_info() {
        let info = get_system_info().unwrap();
        assert!(info.cpu_usage >= 0.0 && info.cpu_usage <= 100.0);
    }
}
```

### 11.2 集成测试
- 测试前后端通信
- 测试跨平台兼容性
- 测试性能指标

### 11.3 E2E 测试
- 使用 Spectron 或 Playwright
- 测试用户流程
- 回归测试

---

## 12. 开发时间估算

| 阶段 | 任务 | 预计时间 |
|-----|------|---------|
| 阶段一 | 项目初始化 + 环境配置 | 2-3 天 |
| 阶段二 | 前端代码迁移 + Tauri 集成 | 3-5 天 |
| 阶段三 | 后端核心功能开发（系统监控） | 5-7 天 |
| 阶段四 | 网络监控 + 设备控制 | 4-6 天 |
| 阶段五 | 跨平台适配 + 测试 | 3-5 天 |
| 阶段六 | 打包部署 + 文档 | 2-3 天 |
| **总计** | | **19-29 天** |

---

## 13. 后续扩展方向

### 13.1 功能扩展
- 移动端支持（Tauri Mobile）
- 云端数据同步
- AI 智能分析
- 语音控制集成

### 13.2 技术升级
- 升级到 Tauri 2.0
- 集成更多系统 API
- 插件化架构

---

## 14. 参考资源

### 官方文档
- [Tauri 官方文档](https://tauri.app/)
- [Rust 官方文档](https://www.rust-lang.org/)
- [Tailwind CSS 文档](https://tailwindcss.com/)

### 社区资源
- [Tauri GitHub](https://github.com/tauri-apps/tauri)
- [Awesome Tauri](https://github.com/tauri-apps/awesome-tauri)
- [Rust 中文社区](https://rustcc.cn/)

---

## 15. 总结

选择 **Tauri + Rust + Web 技术** 作为技术栈，具有以下优势：

✅ **完美复用现有代码**：可直接使用现有的 HTML/CSS/JS  
✅ **跨平台支持**：Windows 和树莓派无缝支持  
✅ **轻量高效**：资源占用低，性能优秀  
✅ **安全可靠**：Rust 内存安全，无传统漏洞  
✅ **开发效率高**：前后端分离，易于维护  
✅ **打包体积小**：最终应用 < 10MB  

该技术栈能够满足项目需求，是一个理想的选择。
